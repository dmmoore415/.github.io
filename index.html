<html><head><title>SPOT Contract Search</title>

<script type="text/javascript" src="//www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load('visualization', '1', {'packages':['table']});

function removeChildrenFromNode(node) {
  if (node.hasChildNodes()) {
    while(node.childNodes.length >= 1 ) {
        node.removeChild(node.firstChild);       
    } 
  }
}
var key='1N0RgS_cckfZ4f3todJ4XIXBZFg5zuMfDJ33ExNCIOZ0';
  
function drawViz() {
  var company = document.getElementById('company').value;
  var date = document.getElementById('date').value;
  var gq='SELECT * WHERE A CONTAINS("' + company + '")'
  if (date != "") {
    qq += ' AND C <= Date "' + date + '" AND Date "' + date + '" <= D';
  }
  document.getElementById('gqpreview').innerHTML=gq;
  gq=encodeURIComponent(gq);
  
  var url='http://spreadsheets.google.com/tq?tq='+gq+'&key='+key;
                
  var query = new google.visualization.Query(url);
  query.send(handleQueryResponse2);
}

function handleQueryResponse2(response) {
  if (response.isError()) {
    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

  var data = response.getDataTable();
  removeChildrenFromNode(document.getElementById('preview'));
  new google.visualization.Table(document.getElementById('preview')).draw(data, null);      
}

</script>
 
</head>
<body>
<h1>SPOT Contract Search</h1>
<form name="args" onsubmit="drawViz(); return false">
Company <input type="text" size=30 id='company'  /> 
Date <input type="date" size=30 id='date'/> 
<input type="button" value='Search' onclick="drawViz()"/>
</form>
<hr/>

<div>So you are asking: <em id='gqpreview'></em></div>
<div id="preview"></div>

</body>
